import"./modulepreload-polyfill-B5Qt9EMX.js";var v=["Brazil","Poland","South Korea"],w="/src/map.geojson",h=1/0,g=-1/0,p={},H={Brazil:"BRA",Poland:"POL","South Korea":"KOR"};function N(t){var e=1/0,n=-1/0;return t.forEach(o=>{o==null||!isFinite(o)||(o<e&&(e=o),o>n&&(n=o))}),(!isFinite(e)||!isFinite(n)||e===n)&&(e=0,n=1),{min:e,max:n}}function S(t,e,n){if(t==null||!isFinite(t))return null;if(n===e)return 0;var o=(t-e)/(n-e);return Math.max(0,Math.min(1,o))}const W="";async function Y(t){var e=["NY.GDP.MKTP.CD","EN.ATM.PM25.MC.M3","AG.LND.FRST.ZS","EN.ATM.CO2E.PC"].join(","),n=`${W}/api/country/${t}/series?codes=${encodeURIComponent(e)}`,o=await fetch(n);if(!o.ok)throw new Error("API error: "+n);return await o.json()}function V(t){var e={};return t.forEach(n=>{var o=Number(n.year);e[o]||(e[o]={}),n.code==="NY.GDP.MKTP.CD"&&(e[o].gdp=n.value),n.code==="EN.ATM.PM25.MC.M3"&&(e[o].pm25=n.value),n.code==="AG.LND.FRST.ZS"&&(e[o].forest=n.value),n.code==="EN.ATM.CO2E.PC"&&(e[o].co2raw=n.value)}),e}async function X(){for(var t={},e=0;e<v.length;e++){var n=v[e],o=H[n],r=await Y(o);t[n]=V(r)}var l=[],i=[],u=[];Object.values(t).forEach(c=>{Object.values(c).forEach(f=>{f.pm25!=null&&l.push(f.pm25),f.forest!=null&&i.push(f.forest),f.co2raw!=null&&u.push(f.co2raw)})});var a=N(l),s=N(i),m=N(u);p={},Object.entries(t).forEach(([c,f])=>{p[c]={},Object.entries(f).forEach(([M,d])=>{var Z=Number(M),G=d.pm25==null?null:1-S(d.pm25,a.min,a.max),$=d.forest==null?null:S(d.forest,s.min,s.max),j=d.co2raw==null?null:1-S(d.co2raw,m.min,m.max);p[c][Z]={air:G,forest:$,co2:j,gdp:d.gdp}})}),typeof I=="function"&&I(),typeof A=="function"&&A(),typeof y=="function"&&y()}(async function(){try{await X()}catch(t){console.error(t),alert("data loading failed"+(t.message||t))}})();const k={Brazil:5.5,Poland:5,"South Korea":4.5},T={Brazil:0,Poland:.25,"South Korea":.55},R={Brazil:0,Poland:-4,"South Korea":-8};function x(t){var e=String(t||"");return e=e.toLowerCase(),e=e.replace(/[,]/g,""),e=e.replace(/[_\-]+/g," "),e=e.replace(/\s+/g," "),e=e.trim(),e}var J=new Map([["brazil","Brazil"],["poland","Poland"],["south korea","South Korea"],["korea south","South Korea"],["korea republic of","South Korea"],["republic of korea","South Korea"],["korea_south","South Korea"]]);function U(t){var e=x(t);return J.get(e)||t}function q(t,e){var n=[];t&&t.shapeName&&n.push(t.shapeName),t&&t.ADMIN&&n.push(t.ADMIN),t&&t.NAME_EN&&n.push(t.NAME_EN),t&&t.NAME&&n.push(t.NAME);var o,r=[];for(o=0;o<n.length;o++)r.push(x(U(n[o])));return r.indexOf(x(e))!==-1}function Q(t){return t.replace(/\s+/g,"-")}const F=["rgba(205, 180, 219, 1)","rgba(195, 207, 109, 1)"];function tt(t){return Math.max(0,Math.min(1,t))}function D(t){const e=t.replace(/[^\d.,]/g,"").split(",").map(Number),[n,o,r,l=1]=e;return{r:n,g:o,b:r,a:l}}function E(t,e,n){return t+(e-t)*n}function et(t,e,n){const o=D(t),r=D(e),l=Math.round(E(o.r,r.r,n)),i=Math.round(E(o.g,r.g,n)),u=Math.round(E(o.b,r.b,n)),a=E(o.a,r.a,n);return`rgba(${l}, ${i}, ${u}, ${a})`}function C(t){const e=tt(Number.isFinite(t)?t:0);return et(F[0],F[1],e)}function A(){const t=C(0),e=C(1),n=document.getElementById("legendBarH");n&&(n.style.background=`linear-gradient(90deg, ${t} 0%, ${e} 100%)`)}var z={},b={},B=null;function nt(){return B?Promise.resolve(B):fetch(w).then(function(t){if(!t.ok)throw new Error("Failed to load "+w);return t.json()}).then(function(t){return B=t,t})}function _(t){var e=t&&t.getBoundingClientRect?t.getBoundingClientRect():{width:420,height:420},n=Math.min(e.width,e.height),o=Math.round(n*.04);return o<16&&(o=16),o>80&&(o=80),o}function O(t,e){const n=L.map(t,{zoomControl:!1,dragging:!1,scrollWheelZoom:!1,doubleClickZoom:!1,boxZoom:!1,keyboard:!1,tap:!1,attributionControl:!1});return nt().then(o=>{const r=o.features.filter(a=>q((a==null?void 0:a.properties)||{},e));if(r.length===0){const a=document.getElementById(t);a&&(a.innerHTML=`<div style="padding:8px;color:#c00;font-size:12px;">
            No feature for ${e}
          </div>`);return}const l=L.geoJSON({type:"FeatureCollection",features:r},{style:{color:"#778899",weight:1.2,opacity:.9,fillColor:"#ffffff",fillOpacity:1}}).addTo(n),i=k[e]||6,u=l.getBounds();if(u!=null&&u.isValid&&u.isValid()){const a=_(document.getElementById(t))+(R[e]||0);n.fitBounds(u,{padding:[a,a],maxZoom:i}),n.setZoom(n.getZoom()+(T[e]||0))}requestAnimationFrame(()=>{n.invalidateSize();const a=l.getBounds();if(a!=null&&a.isValid&&a.isValid()){const s=_(document.getElementById(t))+(R[e]||0);n.fitBounds(a,{padding:[s,s],maxZoom:i}),n.setZoom(n.getZoom()+(T[e]||0))}}),z[e]=n,b[e]=l}).catch(o=>{const r=document.getElementById(t);r&&(r.innerHTML=`<div style="padding:8px;color:#c00;font-size:12px;">
          ${String(o.message||o)}
        </div>`)})}function y(){var t=document.getElementById("metricSel"),e=document.getElementById("yearInput"),n=document.getElementById("yearVal");if(!(!t||!e)){var o=t.value,r=Number(e.value);n&&(n.textContent=r);for(var l=0;l<v.length;l++){var i=v[l],u=b[i],a=p[i]&&p[i][r]?p[i][r]:null,s=a?a[o]:null,m=s==null?"#eeeeee":C(s);u&&(u.setStyle({fillColor:m,fillOpacity:1}),u.eachLayer(function(M){M.unbindTooltip();var d=i+" â€¢ "+o+": "+(s==null?"n/a":s.toFixed(2));M.bindTooltip(d,{sticky:!0})}));var c=a?a.gdp:null,f=ot(c,h,g);it(i,f)}A()}}function I(){h=1/0,g=-1/0,v.forEach(function(t){var e=p[t]||{};Object.keys(e).forEach(function(n){var o=e[n].gdp;o!=null&&(o<h&&(h=o),o>g&&(g=o))})}),(!isFinite(h)||!isFinite(g)||h===g)&&(h=0,g=1)}function ot(t,e,n){return t==null||!isFinite(t)||t<=e?0:t>=n?1:(t-e)/(n-e)}const P=12,at=20,K=38,rt=30;function it(t,e){const n=Q(t),o=document.getElementById("stack-"+n);if(!o)return;const l=Math.round((e||0)*50);o.innerHTML="";const i=Math.max(1,Math.ceil(l/P)),u=i*K+20;o.style.height=Math.max(u,60)+"px";for(let a=0;a<l;a++){const s=Math.floor(a/P),m=a%P,c=document.createElement("img");c.src="/img/money.png",c.className="cash-note",c.style.left=m*at+"px",c.style.top=(i-1-s)*K+"px",c.style.width=rt+"px",o.appendChild(c)}}(function(){Promise.all([O("map-brazil","Brazil"),O("map-poland","Poland"),O("map-korea","South Korea")]).then(function(){var e=document.getElementById("metricSel"),n=document.getElementById("yearInput");e&&e.addEventListener("change",y),n&&n.addEventListener("input",y),I(),A(),y();function o(){for(var r=0;r<v.length;r++){var l=v[r],i=z[l],u=b[l];if(!(!i||!u)){i.invalidateSize();var a=u.getBounds();if(a&&a.isValid&&a.isValid()){var s=_(i.getContainer()),m=k[l]||6;i.fitBounds(a,{padding:[s,s],maxZoom:m})}}}}requestAnimationFrame(o),window.addEventListener("resize",o)})})();
